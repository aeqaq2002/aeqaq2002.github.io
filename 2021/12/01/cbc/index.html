<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="AEQAQ">
    
    <title>
        
            cbcå­—èŠ‚åè½¬æ”»å‡»å…¥é—¨ |
        
        äººæ­»åä¼šå»ç”µå½±é™¢
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/icon.svg">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":true,"init_open":false},"style":{"primary_color":"#0066CC","avatar":"/images/touxiang.jpeg","favicon":"/images/icon.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"Learn. Spread. Learn."},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":false}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":false,"style":"default"},"pjax":{"enable":false},"lazyload":{"enable":false},"version":"3.4.3"};
    KEEP.language_ago = {"second":"%s ç§’å‰","minute":"%s åˆ†é’Ÿå‰","hour":"%s å°æ—¶å‰","day":"%s å¤©å‰","week":"%s å‘¨å‰","month":"%s æœˆå‰","year":"%s å¹´å‰"};
  </script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                äººæ­»åä¼šå»ç”µå½±é™¢
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                é¦–é¡µ
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                å½’æ¡£
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                æ ‡ç­¾
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                å…³äº
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">é¦–é¡µ</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">å½’æ¡£</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">æ ‡ç­¾</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">å…³äº</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">cbcå­—èŠ‚åè½¬æ”»å‡»å…¥é—¨</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/touxiang.jpeg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">AEQAQ</span>
                        
                            <span class="author-label">Lv1</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2021-12-01 21:43:16
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/web/">web</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/cbc/">cbc</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h1 id="1-åŸºæœ¬æ¦‚å¿µ"><a href="#1-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1.    åŸºæœ¬æ¦‚å¿µ"></a>1.    åŸºæœ¬æ¦‚å¿µ</h1><h2 id="1-1-CBCæ¨¡å¼"><a href="#1-1-CBCæ¨¡å¼" class="headerlink" title="1.1    CBCæ¨¡å¼"></a>1.1    CBCæ¨¡å¼</h2><p>1976å¹´ï¼ŒIBMå‘æ˜äº†å¯†ç åˆ†ç»„é“¾æ¥ï¼ˆCBCï¼ŒCipher-block chainingï¼‰æ¨¡å¼ã€‚åœ¨CBCæ¨¡å¼ä¸­ï¼Œæ¯ä¸ªæ˜æ–‡å—å…ˆä¸<strong>å‰ä¸€ä¸ªå¯†æ–‡å—</strong>è¿›è¡Œ<strong>å¼‚æˆ–</strong>åï¼Œå†è¿›è¡ŒåŠ å¯†ã€‚åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œæ¯ä¸ªå¯†æ–‡å—éƒ½ä¾èµ–äºå®ƒå‰é¢çš„æ‰€æœ‰æ˜æ–‡å—ã€‚åŒæ—¶ï¼Œä¸ºäº†ä¿è¯æ¯æ¡æ¶ˆæ¯çš„å”¯ä¸€æ€§ï¼Œåœ¨ç¬¬ä¸€ä¸ªå—ä¸­éœ€è¦ä½¿ç”¨åˆå§‹åŒ–å‘é‡ã€‚</p>
<h3 id="åŠ å¯†è¿‡ç¨‹ï¼š"><a href="#åŠ å¯†è¿‡ç¨‹ï¼š" class="headerlink" title="åŠ å¯†è¿‡ç¨‹ï¼š"></a>åŠ å¯†è¿‡ç¨‹ï¼š</h3><p><img src="https://www.mi1k7ea.com/2020/09/17/%E6%B5%85%E6%9E%90CBC%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB%E4%B8%8EPadding-Oracle-Attack/1.png" alt="img"></p>
<ul>
<li><strong>Plaintext</strong>ï¼šæ˜æ–‡æ•°æ®ï¼›</li>
<li><strong>Initialzation Vectorï¼ˆIVï¼‰</strong>ï¼šåˆå§‹å‘é‡ï¼›</li>
<li><strong>Key</strong>ï¼šåˆ†ç»„åŠ å¯†ä½¿ç”¨çš„å¯†é’¥ï¼›</li>
<li><strong>Ciphertext</strong>ï¼šå¯†æ–‡æ•°æ®ï¼›</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Ciphertext-0 = Encrypt(Plaintext XOR IV)â€”åªç”¨äºç¬¬ä¸€ä¸ªç»„å—</span><br><span class="line">Ciphertext-N= Encrypt(Plaintext XOR Ciphertext-N-1)â€”ç”¨äºç¬¬äºŒåŠå‰©ä¸‹çš„ç»„å—</span><br></pre></td></tr></table></figure>

<p>åŠ å¯†æ­¥éª¤ï¼š</p>
<ol>
<li>é¦–å…ˆå°†æ˜æ–‡åˆ†æˆé•¿åº¦ç›¸åŒï¼ˆä¸€èˆ¬ä¸º8æˆ–16å­—èŠ‚ï¼‰çš„nç»„ï¼Œå…¶ä¸­æœ€åä¸€ç»„ä½æ•°ä¸è¶³çš„è¿›è¡ŒPaddingæ“ä½œï¼ˆå¡«å……è§„åˆ™æ˜¯PKCS #5æˆ–PKCS #7ï¼‰ï¼›</li>
<li>ç”Ÿæˆä¸€ä¸ªéšæœºçš„åˆå§‹å‘é‡ï¼ˆIVï¼‰å’Œä¸€ä¸ªå¯†é’¥ï¼ˆKeyï¼‰ï¼›</li>
<li>å°†IVä¸ç¬¬ä¸€ç»„æ˜æ–‡è¿›è¡ŒXORï¼Œå°†XORåçš„ç»“æœä½¿ç”¨Keyè¿›è¡ŒåŠ å¯†å¾—åˆ°ç¬¬ä¸€ç»„å¯†æ–‡ï¼›</li>
<li>å°†ç¬¬ä¸€ç»„å¯†æ–‡å’Œç¬¬äºŒç»„æ˜æ–‡è¿›è¡ŒXORï¼Œå°†XORåçš„ç»“æœä½¿ç”¨Keyè¿›è¡ŒåŠ å¯†å¾—åˆ°ç¬¬äºŒç»„å¯†æ–‡ï¼›</li>
<li>ä¾æ¬¡ç±»æ¨ï¼Œå°†ç¬¬n-1ç»„å¯†æ–‡å’Œç¬¬nç»„æ˜æ–‡è¿›è¡ŒXORï¼Œå°†XORåçš„ç»“æœä½¿ç”¨Keyè¿›è¡ŒåŠ å¯†å¾—åˆ°ç¬¬nç»„å¯†æ–‡ï¼›</li>
<li>å°†IVå’Œå¾—åˆ°çš„æ‰€æœ‰åˆ†ç»„å¯†æ–‡æ‹¼æ¥åˆ°ä¸€èµ·ï¼Œå¾—åˆ°æœ€ç»ˆçš„å¯†æ–‡ï¼›</li>
</ol>
<h3 id="è§£å¯†è¿‡ç¨‹ï¼š"><a href="#è§£å¯†è¿‡ç¨‹ï¼š" class="headerlink" title="è§£å¯†è¿‡ç¨‹ï¼š"></a>è§£å¯†è¿‡ç¨‹ï¼š</h3><p><img src="http://l1nk3r.xmutsec.com/blog/mh3xk.jpg" alt="10"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Plaintext-0 = Decrypt(Ciphertext) XOR IVâ€”åªç”¨äºç¬¬ä¸€ä¸ªç»„å—</span><br><span class="line">Plaintext-N= Decrypt(Ciphertext) XOR Ciphertext-N-1â€”ç”¨äºç¬¬äºŒåŠå‰©ä¸‹çš„ç»„å—</span><br></pre></td></tr></table></figure>

<p>è§£å¯†æ­¥éª¤ï¼š</p>
<ol>
<li>é¦–å…ˆä»å¯†æ–‡ä¸­æå–å‡ºåˆå§‹å‘é‡ï¼ˆIVï¼‰ï¼Œç„¶åå°†å¯†æ–‡åˆ†æˆnç»„ï¼ˆä¸€èˆ¬ä¸º8æˆ–16å­—èŠ‚ä¸€ç»„ï¼‰ï¼›</li>
<li>ä½¿ç”¨å¯†é’¥ï¼ˆKeyï¼‰å¯¹ç¬¬ä¸€ç»„å¯†æ–‡è¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°è§£å¯†çš„ä¸­é—´å€¼æˆ‘ä»¬ç§°ä¸ºIntermediary Valueï¼›</li>
<li>ä½¿ç”¨IVä¸ç¬¬ä¸€ç»„Intermediary Valueè¿›è¡ŒXORï¼Œå¾—åˆ°ç¬¬ä¸€ç»„æ˜æ–‡ï¼›</li>
<li>ä½¿ç”¨Keyå¯¹ç¬¬nç»„å¯†æ–‡è¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°ç¬¬nç»„Intermediary Valueï¼›</li>
<li>ä½¿ç”¨ç¬¬n-1ç»„å¯†æ–‡ä¸ç¬¬nç»„Intermediary Valueè¿›è¡ŒXORï¼Œå¾—åˆ°ç¬¬nç»„æ˜æ–‡ï¼›</li>
<li>å°†æ‰€æœ‰åˆ†ç»„æ˜æ–‡æ‹¼æ¥åˆ°ä¸€èµ·ï¼Œå¾—åˆ°æœ€ç»ˆçš„æ˜æ–‡ï¼›0</li>
</ol>
<p>æ³¨æ„ï¼šCiphertext-N-1ï¼ˆå¯†æ–‡-N-1ï¼‰æ˜¯ç”¨æ¥äº§ç”Ÿä¸‹ä¸€å—æ˜æ–‡ï¼›è¿™å°±æ˜¯å­—èŠ‚ç¿»è½¬æ”»å‡»å¼€å§‹å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚å¦‚æœæˆ‘ä»¬æ”¹å˜Ciphertext-N-1ï¼ˆå¯†æ–‡-N-1ï¼‰çš„ä¸€ä¸ªå­—èŠ‚ï¼Œç„¶åä¸ä¸‹ä¸€ä¸ªè§£å¯†åçš„ç»„å—å¼‚æˆ–ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªä¸åŒçš„æ˜æ–‡äº†ï¼</p>
<p><img src="http://drops.xmd5.com/full/157b4078de6a8615e7c4be958d4d89164f1810e9.jpg" alt="enter image description here"></p>
<p><a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation" >https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="1-2-å¼‚æˆ–"><a href="#1-2-å¼‚æˆ–" class="headerlink" title="1.2 å¼‚æˆ–"></a>1.2 å¼‚æˆ–</h2><p>å¼‚æˆ–ï¼ˆXORï¼‰æ˜¯ä¸€ä¸ªæ•°å­¦è¿ç®—ç¬¦ã€‚å®ƒåº”ç”¨äºé€»è¾‘è¿ç®—ã€‚å¼‚æˆ–çš„æ•°å­¦ç¬¦å·ä¸ºâ€œâŠ•â€ï¼Œè®¡ç®—æœºç¬¦å·ä¸ºâ€œxorâ€ã€‚å…¶è¿ç®—æ³•åˆ™ä¸ºï¼š</p>
<p>aâŠ•b = (Â¬a âˆ§ b) âˆ¨ (a âˆ§Â¬b)</p>
<p>å¦‚æœaã€bä¸¤ä¸ªå€¼ä¸ç›¸åŒï¼Œåˆ™å¼‚æˆ–ç»“æœä¸º1ã€‚å¦‚æœaã€bä¸¤ä¸ªå€¼ç›¸åŒï¼Œå¼‚æˆ–ç»“æœä¸º0ã€‚</p>
<p>åœ¨è®¡ç®—æœºä¸­ï¼Œå­˜å‚¨çš„æ•°æ®æ˜¯ä»¥äºŒè¿›åˆ¶çš„æ ¼å¼å­˜å…¥çš„ï¼ŒæŠŠä¸¤æ®µäºŒè¿›åˆ¶æ•°å­—è¿›è¡Œå¼‚æˆ–è¿ç®—çš„è¯ï¼Œç›¸åŒçš„å¾—0ï¼Œä¸åŒçš„å¾—1ã€‚å­—ç¬¦åœ¨è®¡ç®—æœºä¸­æœ‰å¯¹åº”çš„ASCIIç å€¼ï¼Œå¯¹å­—ç¬¦è¿›è¡Œå¼‚æˆ–è¿ç®—å°±æ˜¯å°†ä¸¤ä¸²å­—ç¬¦å¯¹åº”çš„ASCIIç å€¼è¿›è¡Œå¼‚æˆ–ã€‚</p>
<p><strong>å¼‚æˆ–è¿ç®—å…·æœ‰å¯é€†æ€§ï¼Œa xor b = c ç­‰ä»·äº b xor c = a ç­‰ä»·äº a xor c = bã€‚</strong></p>
<h1 id="2-simple-demo"><a href="#2-simple-demo" class="headerlink" title="2.    simple demo"></a>2.    simple demo</h1><p>è·Ÿç€<strong>L1NK3R</strong>å¸ˆå‚…çš„åšå®¢æ‘¸ç´¢ä¸€é</p>
<p>ä¸‹é¢æ˜¯ä¸€æ®µæ˜æ–‡åºåˆ—ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:2:&#123;s:4:&quot;name&quot;;s:6:&quot;sdsdsd&quot;;s:8:&quot;greeting&quot;;s:20:&quot;echo &#x27;Hello sdsdsd!&#x27;&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>ç›®æ ‡ï¼šå°†â€œs:6â€å½“ä¸­çš„æ•°å­—6è½¬æ¢æˆæ•°å­—â€œ7â€ã€‚æˆ‘ä»¬éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯æŠŠæ˜æ–‡åˆ†æˆ16ä¸ªå­—èŠ‚çš„å—ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Block 1:	a:2:&#123;s:4:&quot;name&quot;;</span><br><span class="line">Block 2:	s:6:&quot;sdsdsd&quot;;s:8</span><br><span class="line">Block 3:	:&quot;greeting&quot;;s:20</span><br><span class="line">Block 4:	:&quot;echo &#x27;Hello sd</span><br><span class="line">Block 5:	sdsd!&#x27;&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>å› æ­¤,æ ¹æ®ç¬¬ä¸€èŠ‚æœ«æˆ‘ä»¬è®²çš„ï¼Œ</p>
<p><em><strong>ç›®æ ‡å­—ç¬¦ä½äºå—2ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦æ”¹å˜å—ä¸€çš„å¯†æ–‡æ¥æ”¹å˜ç¬¬äºŒå—çš„æ˜æ–‡ã€‚</strong></em></p>
<p><em><strong>ä½ åœ¨å¯†æ–‡ä¸­æ”¹å˜çš„å­—èŠ‚ï¼Œåªä¼šå½±å“åˆ°åœ¨ä¸‹ä¸€æ˜æ–‡å½“ä¸­ï¼Œå…·æœ‰ç›¸åŒåç§»é‡çš„å­—èŠ‚ã€‚</strong></em></p>
<p>å› æ­¤æˆ‘ä»¬è¦æ”¹å˜åœ¨ç¬¬ä¸€ä¸ªå¯†æ–‡å—å½“ä¸­ï¼Œåç§»é‡æ˜¯2çš„å­—èŠ‚ã€‚æ­£å¦‚ä½ åœ¨ä¸‹é¢çš„ä»£ç å½“ä¸­çœ‹åˆ°çš„ï¼Œåœ¨ç¬¬2è¡Œæˆ‘ä»¬å¾—åˆ°äº†æ•´ä¸ªæ•°æ®çš„å¯†æ–‡ï¼Œç„¶ååœ¨ç¬¬3è¡Œä¸­ï¼Œæˆ‘ä»¬æ”¹å˜å—1ä¸­åç§»é‡ä¸º2çš„å­—èŠ‚ï¼Œæœ€åæˆ‘ä»¬å†è°ƒç”¨è§£å¯†å‡½æ•°ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">define(<span class="string">&#x27;MY_AES_KEY&#x27;</span>, <span class="string">&quot;abcdef0123456789&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aes</span>(<span class="params"><span class="variable">$data</span>, <span class="variable">$encrypt</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$aes</span> = mcrypt_module_open(MCRYPT_RIJNDAEL_128, <span class="string">&#x27;&#x27;</span>, MCRYPT_MODE_CBC, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="variable">$iv</span> = <span class="string">&quot;1234567891234567&quot;</span>;</span><br><span class="line">    mcrypt_generic_init(<span class="variable">$aes</span>, MY_AES_KEY, <span class="variable">$iv</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$encrypt</span> ? mcrypt_generic(<span class="variable">$aes</span>,<span class="variable">$data</span>) : mdecrypt_generic(<span class="variable">$aes</span>,<span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">define(<span class="string">&#x27;MY_MAC_LEN&#x27;</span>, <span class="number">40</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encrypt</span>(<span class="params"><span class="variable">$data</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> aes(<span class="variable">$data</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decrypt</span>(<span class="params"><span class="variable">$data</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$data</span> = rtrim(aes(<span class="variable">$data</span>, <span class="literal">false</span>), <span class="string">&quot;\0&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$v</span> = <span class="string">&#x27;a:2:&#123;s:4:&quot;name&quot;;s:6:&quot;sdsdsd&quot;;s:8:&quot;greeting&quot;;s:20:&quot;echo \&#x27;Hello sdsdsd!\&#x27;&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$v</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="variable">$enc</span> = @encrypt(<span class="variable">$v</span>);</span><br><span class="line"><span class="variable">$enc</span>[<span class="number">2</span>] = chr(ord(<span class="variable">$enc</span>[<span class="number">2</span>]) ^ ord(<span class="string">&quot;6&quot;</span>) ^ ord (<span class="string">&quot;7&quot;</span>));</span><br><span class="line"><span class="variable">$b</span> = @decrypt(<span class="variable">$enc</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br></pre></td></tr></table></figure>

<p>output:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a:2:&#123;s:4:&quot;name&quot;;s:6:&quot;sdsdsd&quot;;s:8:&quot;greeting&quot;;s:20:&quot;echo &#x27;Hello sdsdsd!&#x27;&quot;;&#125;</span><br><span class="line">ï¿½1ï¿½ï¿½Ã®qvï¿½ï¿½Cï¿½fs:7:&quot;sdsdsd&quot;;s:8:&quot;greeting&quot;;s:20:&quot;echo &#x27;Hello sdsdsd!&#x27;&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œ6å·²ç»è¢«æˆ‘ä»¬å˜ä¸ºäº†7</p>
<p>åŸç†å¦‚ä¸‹ï¼š</p>
<p>A = Decrypt(Ciphertext)ä¸B = Ciphertext-N-1å¼‚æˆ–åæœ€ç»ˆå¾—åˆ°C = 6ã€‚ç­‰ä»·äºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C = A XOR B</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å”¯ä¸€ä¸çŸ¥é“çš„å€¼å°±æ˜¯Aï¼ˆæ³¨ï¼šå¯¹äºBï¼ŒCæ¥è¯´ï¼‰ï¼ˆblock cipher decryptionï¼‰;å€Ÿç”±XORï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ˜“åœ°å¾—åˆ°Açš„å€¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A = B XOR C</span><br></pre></td></tr></table></figure>

<p>A XOR B XOR Cç­‰äº0</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ord($enc[2]) ^ ord(&quot;6&quot;) ^ ord (&quot;7&quot;)</span><br><span class="line">B		^		C		^		ç›®æ ‡å€¼ </span><br></pre></td></tr></table></figure>

<p>å¦‚æ­¤è®¡ç®—å‡ºAï¼Œç„¶åå°±å¯ä»¥æ ¹æ®åŸæ¥çš„é€»è¾‘ä»¥Aå¾—åˆ°Cï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æƒ³è¦ä¿®æ”¹çš„å€¼</p>
<p>æˆ‘ä»¬æ§åˆ¶Aä¸ºæˆ‘ä»¬è®¡ç®—å‡ºæ¥çš„payloadå³å¯</p>
<h1 id="3-ä¾‹é¢˜"><a href="#3-ä¾‹é¢˜" class="headerlink" title="3.ä¾‹é¢˜"></a>3.ä¾‹é¢˜</h1><p>iscc2018 ã€ŠOnly admin can see flagã€‹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;sqlwaf.php&#x27;</span>;</span><br><span class="line">define(<span class="string">&quot;SECRET_KEY&quot;</span>, <span class="string">&quot;................&quot;</span>);</span><br><span class="line">define(<span class="string">&quot;METHOD&quot;</span>, <span class="string">&quot;aes-128-cbc&quot;</span>);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_random_iv</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$iv</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="number">16</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="variable">$iv</span>.=chr(rand(<span class="number">1</span>,<span class="number">255</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$iv</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$info</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$iv</span>=get_random_iv();</span><br><span class="line">    <span class="variable">$plain</span> = serialize(<span class="variable">$info</span>);</span><br><span class="line">    <span class="variable">$cipher</span> = openssl_encrypt(<span class="variable">$plain</span>, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, <span class="variable">$iv</span>);</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="variable">$info</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    setcookie(<span class="string">&quot;iv&quot;</span>, base64_encode(<span class="variable">$iv</span>));</span><br><span class="line">    setcookie(<span class="string">&quot;cipher&quot;</span>, base64_encode(<span class="variable">$cipher</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">show_homepage</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>]===<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;Hello admin&lt;/p&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;Flag is *************&lt;/p&gt;&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;hello &#x27;</span>.<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>].<span class="string">&#x27;&lt;/p&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;Only admin can see flag&lt;/p&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;&lt;a href=&quot;loginout.php&quot;&gt;Log out&lt;/a&gt;&lt;/p&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_login</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;cipher&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;iv&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$cipher</span> = base64_decode(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;cipher&#x27;</span>]);</span><br><span class="line">        <span class="variable">$iv</span> = base64_decode(<span class="variable">$_COOKIE</span>[<span class="string">&quot;iv&quot;</span>]);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$plain</span> = openssl_decrypt(<span class="variable">$cipher</span>, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, <span class="variable">$iv</span>))&#123;</span><br><span class="line">            <span class="variable">$info</span> = unserialize(<span class="variable">$plain</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;&lt;p&gt;base64_decode(&#x27;&quot;</span>.base64_encode(<span class="variable">$plain</span>).<span class="string">&quot;&#x27;) can&#x27;t unserialize&lt;/p&gt;&quot;</span>);</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="variable">$info</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;ERROR!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>])) &#123;</span><br><span class="line">  <span class="variable">$username</span>=waf((<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]);</span><br><span class="line">  <span class="variable">$password</span>=waf((<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$username</span> === <span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&#x27;&lt;p&gt;You are not real admin!&lt;/p&gt;&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$info</span> = <span class="keyword">array</span>(<span class="string">&#x27;username&#x27;</span>=&gt;<span class="variable">$username</span>,<span class="string">&#x27;password&#x27;</span>=&gt;<span class="variable">$password</span>);</span><br><span class="line">        login(<span class="variable">$info</span>);</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>]))&#123;</span><br><span class="line">        check_login();</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span> &gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">  &lt;title&gt;Paper login form&lt;/title&gt;</span><br><span class="line">      &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/style.css&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div id=<span class="string">&quot;login&quot;</span>&gt;</span><br><span class="line">  &lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    &lt;h1&gt;Sign In&lt;/h1&gt;</span><br><span class="line">    &lt;input name=<span class="string">&#x27;username&#x27;</span> type=<span class="string">&quot;text&quot;</span> placeholder=<span class="string">&quot;Username&quot;</span>&gt;</span><br><span class="line">    &lt;input name=<span class="string">&#x27;password&#x27;</span> type=<span class="string">&quot;password&quot;</span> placeholder=<span class="string">&quot;Password&quot;</span>&gt;</span><br><span class="line">    &lt;button&gt;Sign in&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><strong>åˆ†æï¼š</strong></p>
<p>show_homepageå‡½æ•°ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">if</span> (<span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>]===<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;Hello admin&lt;/p&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;Flag is *************&lt;/p&gt;&#x27;</span>;</span><br><span class="line">.....</span><br></pre></td></tr></table></figure>

<p>è¦è®©$_SESSION[â€œusernameâ€]===â€™adminâ€™æˆç«‹ï¼Œæ‰èƒ½è¿”å›flag</p>
<p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬ç›´æ¥åœ¨è¾“å…¥æ¡†é‡Œè¾“å…¥adminï¼Œå¥¹åˆæ˜¯ä¸å…è®¸çš„</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$username</span> === <span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&#x27;&lt;p&gt;You are not real admin!&lt;/p&gt;&#x27;</span>);</span><br></pre></td></tr></table></figure>



<p>å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™é‡Œçš„ååºåˆ—åŒ–æ¥æ§åˆ¶$_SESSION[â€œusernameâ€]===â€™adminâ€™</p>
<p>å›åˆ°check_loginå‡½æ•°</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_login</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;cipher&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;iv&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$cipher</span> = base64_decode(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;cipher&#x27;</span>]);</span><br><span class="line">        <span class="variable">$iv</span> = base64_decode(<span class="variable">$_COOKIE</span>[<span class="string">&quot;iv&quot;</span>]);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$plain</span> = openssl_decrypt(<span class="variable">$cipher</span>, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, <span class="variable">$iv</span>))&#123;</span><br><span class="line">            <span class="variable">$info</span> = unserialize(<span class="variable">$plain</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;&lt;p&gt;base64_decode(&#x27;&quot;</span>.base64_encode(<span class="variable">$plain</span>).<span class="string">&quot;&#x27;) can&#x27;t unserialize&lt;/p&gt;&quot;</span>);</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="variable">$info</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;ERROR!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>æ‰€ä»¥è¦æ±‚æˆ‘ä»¬è¾“å…¥çš„ä¸æ˜¯adminï¼Œä½†ç»è¿‡AESåŠ å¯†åå˜æˆäº†admin</p>
<p><strong>è§£é¢˜ï¼š</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$info</span> = <span class="keyword">array</span>(<span class="string">&#x27;username&#x27;</span>=&gt;<span class="string">&#x27;admi0&#x27;</span>,<span class="string">&#x27;password&#x27;</span>=&gt;<span class="string">&#x27;123456&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$info</span>)</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç”¨æˆ·åç›¸åŒé•¿åº¦ï¼Œä½†æ˜¯ä¸æ˜¯admin</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:2:&#123;s:8:&quot;username&quot;;s:5:&quot;admi0&quot;;s:8:&quot;password&quot;;s:6:&quot;123456&quot;;&#125;</span><br></pre></td></tr></table></figure>



<p>åˆ†å—,16å­—èŠ‚ä¸€åˆ†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a:2:&#123;s:8:&quot;userna</span><br><span class="line">me&quot;;s:5:&quot;admi0&quot;;</span><br><span class="line">s:8:&quot;password&quot;;s</span><br><span class="line">:6:&quot;123456&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€è¦æ§åˆ¶çš„0åœ¨ç¬¬äºŒå—ï¼Œåç§»13</p>
<p>å› æ­¤å¦‚æœæˆ‘ä»¬è¦æ”»å‡»ï¼Œä»£ç æ®µåº”è¯¥æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$enc[2] = chr(ord($enc[13]) ^ ord(&quot;2&quot;) ^ ord (&quot;n&quot;));</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿™é‡Œå¯†æ–‡å€¼å‘ç”Ÿäº†æ”¹å˜ï¼Œè§£å¯†åå¯èƒ½ä¼šå‡ºç°ä¸Šé¢å°demoä¸­çš„ä¹±ç å¯¼è‡´ååºåˆ—åŒ–å¤±è´¥</p>
<p>ç”¨admi0/123456ç™»å½•</p>
<p>æ‹¿åˆ°cookieä¸­cipherçš„å€¼ï¼Œå¹¶ç”¨è„šæœ¬è¿›è¡Œå­—ç¬¦ç¿»è½¬</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> unquote</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> quote_plus</span><br><span class="line"></span><br><span class="line">cipher = <span class="string">&#x27;9AOOYlmVvT4xmjViSqORmkZT%2Bxm2mJf0tsuHd%2BUcf1xrghHyXp8FRoQjkE%2FR4dJu8U8DJfcHcHEGJI2ntOYxHw%3D%3D&#x27;</span></span><br><span class="line">cipher = unquote(cipher)</span><br><span class="line">cipher_de = base64.b64decode(cipher)</span><br><span class="line">ch = <span class="built_in">chr</span>(<span class="built_in">ord</span>(cipher_de[<span class="number">13</span>]) ^ <span class="built_in">ord</span>(<span class="string">&#x27;0&#x27;</span>) ^ <span class="built_in">ord</span>(<span class="string">&#x27;n&#x27;</span>))</span><br><span class="line">cipher_de=cipher_de[<span class="number">0</span>:<span class="number">13</span>]+ch+cipher_de[<span class="number">14</span>::]</span><br><span class="line">rs = base64.b64encode(cipher_de)</span><br><span class="line"><span class="built_in">print</span> quote_plus(rs)</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶é¡µé¢å›æ˜¾</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ww0E9uos3vF/p7Ef76SZNW1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjY6IjEyMzQ1NiI7fQ==</span><br><span class="line"></span><br><span class="line">Ãƒ</span><br><span class="line">.Ã¶Ãª,ÃÃ±.Â§Â±.Ã¯Â¤.5me&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:6:&quot;123456&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œç›®æ ‡å­—ç¬¦ä¸²å·²ç»ç¿»è½¬æˆåŠŸï¼Œä½†æ˜¯ç¬¬ä¸€æ®µçš„å¯†æ–‡è§£å¯†å‡ºæ¥æˆäº†ä¹±ç </p>
<p>ä½†æ˜¯æˆ‘ä»¬æŠŠblock1çš„å¯†æ–‡æ”¹äº†ï¼Œæ¥ä¸‹æ¥è€ƒè™‘æ€ä¹ˆæŠŠblock1ç»™ä»–æ¢å¤ï¼Œä½¿å¾—æ˜æ–‡å¯ä»¥è¢«ååºåˆ—åŒ–</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> unquote</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> quote_plus</span><br><span class="line"></span><br><span class="line">mingwen_de=<span class="string">&#x27;8KV6FFinwp+pUFrattXjQ21lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjY6IjEyMzQ1NiI7fQ==&#x27;</span></span><br><span class="line"><span class="comment">#base64_decode(&#x27;è¿™é‡Œé¢çš„&#x27;) can&#x27;t unserialize</span></span><br><span class="line">mingwen = base64.b64decode(mingwen_de)</span><br><span class="line"><span class="built_in">print</span> mingwen</span><br><span class="line"></span><br><span class="line">iv = <span class="string">&#x27;b6bpYwyjk7rZs4sScY8p4A%3D%3D&#x27;</span></span><br><span class="line"><span class="comment">#æ­¤æ—¶cookieé‡Œçš„iv</span></span><br><span class="line">iv = unquote(iv)</span><br><span class="line">iv_de = base64.b64decode(iv)</span><br><span class="line">new = <span class="string">&#x27;a:2:&#123;s:8:&quot;userna&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    iv_de = iv_de[:i] + <span class="built_in">chr</span>(<span class="built_in">ord</span>(iv_de[i]) ^ <span class="built_in">ord</span>(mingwen[i]) ^ <span class="built_in">ord</span>(new[i])) + iv_de[i+<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(iv_de))</span><br><span class="line"><span class="comment">#ç”¨è¿™ä¸ªç»“æœæŠŠåŸæ¥çš„ivæ¢æ‰</span></span><br></pre></td></tr></table></figure>

<p>æ ¹æ®cbcè§£ç æ—¶çš„è§„åˆ™</p>
<p>C1 ^ IV =&gt; B1</p>
<p>æ‰€ä»¥æˆ‘ä»¬åªè¦æ±‚å‡ºæ­£ç¡®çš„IVå°±å¯ä»¥æ§åˆ¶B1ä¸ºæˆ‘ä»¬æƒ³è¦çš„å€¼ï¼Œè¿™å’Œä¸Šé¢çš„ç¿»è½¬æ”»å‡»æœ‰ç›¸ä¼¼çš„åœ°æ–¹</p>
<p><img src="/images/image-20211201211008656.png"></p>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://www.mi1k7ea.com/2020/09/17/%E6%B5%85%E6%9E%90CBC%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB%E4%B8%8EPadding-Oracle-Attack/" >https://www.mi1k7ea.com/2020/09/17/%E6%B5%85%E6%9E%90CBC%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB%E4%B8%8EPadding-Oracle-Attack/<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   target="_blank" rel="noopener" href="http://www.lmxspace.com/2018/05/07/cbc%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB/" >http://www.lmxspace.com/2018/05/07/cbc%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB/<i class="fas fa-external-link-alt"></i></a></p>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>æœ¬æ–‡æ ‡é¢˜ï¼šcbcå­—èŠ‚åè½¬æ”»å‡»å…¥é—¨</li>
        <li>æœ¬æ–‡ä½œè€…ï¼šAEQAQ</li>
        <li>åˆ›å»ºæ—¶é—´ï¼š2021-12-01 21:43:16</li>
        <li>
            æœ¬æ–‡é“¾æ¥ï¼šhttps://aeqaq2002.github.io/2021/12/01/cbc/
        </li>
        <li>
            ç‰ˆæƒå£°æ˜ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
        </li>
    </ul>
</div>

            </div>
        

        
            <div class="article-nav">
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2021/12/01/Viking/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Viking</span>
                                <span class="post-nav-item">ä¸‹ä¸€ç¯‡</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2021</span>
              -
            
            2021&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">AEQAQ</a>
        </div>
        
            <script async  src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        è®¿é—®äººæ•°&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        æ€»è®¿é—®é‡&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            ç”± <a target="_blank" href="https://hexo.io">Hexo</a> é©±åŠ¨&nbsp;|&nbsp;ä¸»é¢˜&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.3</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-text">1.    åŸºæœ¬æ¦‚å¿µ</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-CBC%E6%A8%A1%E5%BC%8F"><span class="nav-text">1.1    CBCæ¨¡å¼</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A0%E5%AF%86%E8%BF%87%E7%A8%8B%EF%BC%9A"><span class="nav-text">åŠ å¯†è¿‡ç¨‹ï¼š</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%AF%86%E8%BF%87%E7%A8%8B%EF%BC%9A"><span class="nav-text">è§£å¯†è¿‡ç¨‹ï¼š</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-%E5%BC%82%E6%88%96"><span class="nav-text">1.2 å¼‚æˆ–</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-simple-demo"><span class="nav-text">2.    simple demo</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-%E4%BE%8B%E9%A2%98"><span class="nav-text">3.ä¾‹é¢˜</span></a></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="æœç´¢..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>



    
<script src="/js/local-search.js"></script>







<div class="post-scripts">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>



</body>
</html>
